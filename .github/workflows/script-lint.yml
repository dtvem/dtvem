name: Lint Install Scripts

on:
  push:
    branches: [ main ]
    paths:
      - 'install.sh'
      - 'install.ps1'
  pull_request:
    branches: [ main ]
    paths:
      - 'install.sh'
      - 'install.ps1'

permissions:
  contents: read

jobs:
  shellcheck:
    name: Lint install.sh
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          additional_files: 'install.sh'

  psscriptanalyzer:
    name: Lint install.ps1
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run PSScriptAnalyzer
        shell: pwsh
        run: |
          Install-Module -Name PSScriptAnalyzer -Force -Scope CurrentUser
          # Exclude PSAvoidUsingWriteHost - Write-Host is intentional for colored installer output
          $results = Invoke-ScriptAnalyzer -Path ./install.ps1 -Severity Error,Warning -ExcludeRule PSAvoidUsingWriteHost,PSUseBOMForUnicodeEncodedFile
          if ($results) {
            $results | Format-Table -AutoSize
            exit 1
          }
          Write-Host "âœ… No issues found in install.ps1"
